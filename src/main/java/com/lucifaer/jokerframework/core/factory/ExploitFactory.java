package com.lucifaer.jokerframework.core.factory;

import com.lucifaer.jokerframework.data.core.ShellDataModel;
import com.lucifaer.jokerframework.modules.Exploit;
import com.lucifaer.jokerframework.utils.ClassUtil;
import org.springframework.beans.factory.FactoryBean;
import org.springframework.beans.factory.annotation.Autowired;

import java.util.Map;

public class ExploitFactory implements FactoryBean {
    @Autowired
    private ShellDataModel shellContext;

    @Override
    public Object getObject() throws Exception {
        Map<String, Class> exploitMap = ClassUtil.getAllClassByInterface(Exploit.class);
        String exploitName = shellContext.getParams().get("exploitName");

        for (String className : exploitMap.keySet()) {
            String key = className.toLowerCase();
            if (key.equals(exploitName+"exploit")) {
                return exploitMap.get(className).newInstance();
            }
        }
        return null;
    }

    @Override
    public Class<?> getObjectType() {
        return Exploit.class;
    }

    @Override
    public boolean isSingleton() {
        return false;
    }
}
